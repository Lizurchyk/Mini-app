<!-- Telegram Subscription Check Modal -->
<div id="subscriptionModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞</h2>
            <button class="modal-close" onclick="closeModal()">√ó</button>
        </div>
        <div class="modal-body">
            <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–≥—Ä–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à Telegram-–∫–∞–Ω–∞–ª:</p>
            
            <div class="telegram-widget">
                <a href="https://t.me/SimpleDLC" target="_blank" class="telegram-channel">
                    <i class="fab fa-telegram"></i>
                    <span>@SimpleDLC</span>
                </a>
                <div id="telegramWidget"></div>
            </div>
            
            <div class="verification-section">
                <p>–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</p>
                <button id="verifySubscription" class="verify-btn" onclick="checkSubscription()">
                    <i class="fas fa-sync-alt"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                </button>
            </div>
            
            <div class="hint">
                <p><strong>–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:</strong></p>
                <ol>
                    <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –∫–∞–Ω–∞–ª–∞ –≤—ã—à–µ</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è" –≤ Telegram</li>
                    <li>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div id="modalOverlay" class="modal-overlay" style="display: none;"></div>

<style>
    /* Modal Styles */
    .modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        z-index: 2000;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    body.dark-theme .modal {
        background: #2d2d2d;
        color: white;
    }
    
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        z-index: 1999;
    }
    
    .modal-header {
        padding: 20px;
        border-bottom: 2px solid var(--purple);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header h2 {
        color: var(--purple);
        font-size: 1.5rem;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #666;
        transition: var(--transition);
    }
    
    .modal-close:hover {
        color: var(--purple);
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .telegram-widget {
        text-align: center;
        margin: 20px 0;
        padding: 20px;
        background: rgba(138, 43, 226, 0.1);
        border-radius: 10px;
    }
    
    .telegram-channel {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 15px 30px;
        background: #0088cc;
        color: white;
        text-decoration: none;
        border-radius: 10px;
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 20px;
        transition: var(--transition);
    }
    
    .telegram-channel:hover {
        background: #0077b3;
        transform: translateY(-2px);
    }
    
    .telegram-channel i {
        font-size: 1.5rem;
    }
    
    .verification-section {
        text-align: center;
        margin: 25px 0;
        padding: 20px;
        border-top: 1px solid #eee;
        border-bottom: 1px solid #eee;
    }
    
    body.dark-theme .verification-section {
        border-color: #444;
    }
    
    .verify-btn {
        background: var(--purple);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 10px;
        margin-top: 15px;
    }
    
    .verify-btn:hover {
        background: var(--purple-light);
        transform: translateY(-2px);
    }
    
    .verify-btn:active {
        transform: translateY(0);
    }
    
    .hint {
        background: rgba(0,0,0,0.05);
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        font-size: 0.9rem;
    }
    
    body.dark-theme .hint {
        background: rgba(255,255,255,0.05);
    }
    
    .hint ol {
        margin-left: 20px;
        margin-top: 10px;
    }
    
    .hint li {
        margin-bottom: 8px;
    }
    
    /* Success Message */
    .success-message {
        color: #28a745;
        text-align: center;
        padding: 15px;
        background: rgba(40, 167, 69, 0.1);
        border-radius: 10px;
        margin: 15px 0;
        display: none;
    }
    
    /* Disable content when modal is open */
    body.modal-open {
        overflow: hidden;
    }
    
    body.modal-open .main-content {
        filter: blur(5px);
        pointer-events: none;
    }
    
    @media (max-width: 480px) {
        .modal {
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .telegram-channel {
            padding: 12px 20px;
            font-size: 1rem;
        }
        
        .verify-btn {
            padding: 12px 20px;
            font-size: 1rem;
        }
    }
</style>

<script>
// Telegram Bot Configuration
const BOT_TOKEN = 'YOUR_BOT_TOKEN_HERE'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
const CHANNEL_USERNAME = '@SimpleDLC'; // –í–∞—à –∫–∞–Ω–∞–ª
const CHAT_ID = 'YOUR_CHANNEL_ID_HERE'; // ID –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞

// Check subscription status on page load
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
    const subscriptionChecked = localStorage.getItem('subscriptionChecked');
    const subscriptionValidUntil = localStorage.getItem('subscriptionValidUntil');
    
    // –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ —Å—Ä–æ–∫ –µ—â–µ –Ω–µ –∏—Å—Ç–µ–∫, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    if (subscriptionChecked === 'true' && subscriptionValidUntil) {
        const expiryDate = new Date(subscriptionValidUntil);
        if (expiryDate > new Date()) {
            console.log('–ü–æ–¥–ø–∏—Å–∫–∞ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ:', expiryDate);
            return;
        }
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –≤–∞–ª–∏–¥–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    setTimeout(() => {
        showSubscriptionModal();
    }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
});

// Show subscription modal
function showSubscriptionModal() {
    document.getElementById('subscriptionModal').style.display = 'block';
    document.getElementById('modalOverlay').style.display = 'block';
    document.body.classList.add('modal-open');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º Telegram Widget –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞
    loadTelegramWidget();
}

// Close modal
function closeModal() {
    document.getElementById('subscriptionModal').style.display = 'none';
    document.getElementById('modalOverlay').style.display = 'none';
    document.body.classList.remove('modal-open');
}

// Load Telegram Widget
function loadTelegramWidget() {
    const widgetContainer = document.getElementById('telegramWidget');
    
    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    widgetContainer.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º iframe —Å Telegram Widget
    const iframe = document.createElement('iframe');
    iframe.src = `https://t.me/${CHANNEL_USERNAME.replace('@', '')}?embed=true`;
    iframe.width = '100%';
    iframe.height = '300';
    iframe.frameBorder = '0';
    iframe.style.borderRadius = '10px';
    iframe.style.marginTop = '15px';
    
    widgetContainer.appendChild(iframe);
}

// Check subscription status
async function checkSubscription() {
    const verifyBtn = document.getElementById('verifySubscription');
    const originalText = verifyBtn.innerHTML;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü—Ä–æ–≤–µ—Ä—è–µ–º...';
    verifyBtn.disabled = true;
    
    try {
        // –ú–µ—Ç–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram Widget API (–±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π, –Ω–æ –º–µ–Ω–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π)
        const isSubscribed = await checkViaTelegramAPI();
        
        // –ú–µ—Ç–æ–¥ 2: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞)
        // const isSubscribed = await checkViaBotAPI();
        
        if (isSubscribed) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ 24 —á–∞—Å–∞
            const expiryDate = new Date();
            expiryDate.setHours(expiryDate.getHours() + 24);
            
            localStorage.setItem('subscriptionChecked', 'true');
            localStorage.setItem('subscriptionValidUntil', expiryDate.toISOString());
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            showSuccessMessage();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                closeModal();
            }, 2000);
        } else {
            alert('‚ùå –í—ã –µ—â–µ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
            verifyBtn.innerHTML = originalText;
            verifyBtn.disabled = false;
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:', error);
        alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
        verifyBtn.innerHTML = originalText;
        verifyBtn.disabled = false;
    }
}

// Method 1: Check via Telegram Widget API (simpler)
async function checkViaTelegramAPI() {
    // –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram Widget –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    // –û–Ω –º–µ–Ω–µ–µ –Ω–∞–¥–µ–∂–µ–Ω, –Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –±–æ—Ç–∞
    
    return new Promise((resolve) => {
        // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π iframe –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        const tempIframe = document.createElement('iframe');
        tempIframe.style.display = 'none';
        tempIframe.src = `https://t.me/${CHANNEL_USERNAME.replace('@', '')}`;
        
        tempIframe.onload = function() {
            // –ü–æ–ø—ã—Ç–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É iframe
            try {
                const iframeDoc = tempIframe.contentDocument || tempIframe.contentWindow.document;
                const bodyText = iframeDoc.body.innerText || '';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–ª—è –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö
                const isSubscribed = !bodyText.includes('Join Channel') && 
                                     !bodyText.includes('–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è') &&
                                     !bodyText.includes('Preview channel');
                
                document.body.removeChild(tempIframe);
                resolve(isSubscribed);
            } catch (e) {
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ iframe, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
                document.body.removeChild(tempIframe);
                resolve(checkViaFallback());
            }
        };
        
        document.body.appendChild(tempIframe);
        
        // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ iframe –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        setTimeout(() => {
            if (document.body.contains(tempIframe)) {
                document.body.removeChild(tempIframe);
            }
            resolve(checkViaFallback());
        }, 5000);
    });
}

// Method 2: Check via Bot API (more reliable but requires bot setup)
async function checkViaBotAPI() {
    if (!BOT_TOKEN || BOT_TOKEN === 'YOUR_BOT_TOKEN_HERE') {
        console.warn('Bot token –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –º–µ—Ç–æ–¥');
        return checkViaFallback();
    }
    
    try {
        // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ Bot API
        // –ü—Ä–∏–º–µ—Ä: const response = await fetch(`/api/check-subscription?userId=${userId}`);
        // return response.ok;
        
        // –¢–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
        return checkViaFallback();
    } catch (error) {
        console.error('Bot API error:', error);
        return checkViaFallback();
    }
}

// Fallback method - asks user to confirm
function checkViaFallback() {
    return new Promise((resolve) => {
        const userConfirmed = confirm(
            '‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.\n\n' +
            '–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª @SimpleDLC.\n\n' +
            '–ù–∞–∂–º–∏—Ç–µ OK –µ—Å–ª–∏ –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã, –∏–ª–∏ –û—Ç–º–µ–Ω–∞ –µ—Å–ª–∏ –Ω–µ—Ç.'
        );
        resolve(userConfirmed);
    });
}

// Show success message
function showSuccessMessage() {
    const modalBody = document.querySelector('.modal-body');
    
    const successMsg = document.createElement('div');
    successMsg.className = 'success-message';
    successMsg.innerHTML = `
        <i class="fas fa-check-circle"></i>
        <h3>‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!</h3>
        <p>–î–æ—Å—Ç—É–ø –∫ –∏–≥—Ä–∞–º –æ—Ç–∫—Ä—ã—Ç –Ω–∞ 24 —á–∞—Å–∞</p>
    `;
    successMsg.style.display = 'block';
    
    modalBody.insertBefore(successMsg, modalBody.firstChild);
    
    const verifyBtn = document.getElementById('verifySubscription');
    verifyBtn.innerHTML = '<i class="fas fa-check"></i> –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!';
    verifyBtn.style.background = '#28a745';
}

// Force subscription check (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É)
window.forceSubscriptionCheck = function() {
    localStorage.removeItem('subscriptionChecked');
    localStorage.removeItem('subscriptionValidUntil');
    showSubscriptionModal();
};
</script>
